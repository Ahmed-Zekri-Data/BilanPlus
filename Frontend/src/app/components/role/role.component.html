<div class="container">
  <h2>Liste des Rôles</h2>
  <input type="text" placeholder="Rechercher un rôle..." (input)="search($event)" class="search-bar" />
  <div *ngIf="loading" class="spinner">
    <div class="spinner-inner"></div>
  </div>
  <table class="role-table">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Description</th>
        <th>Actif</th>
        <th>Permissions</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let role of filteredRoles" @fadeIn>
        <td>{{ role.nom }}</td>
        <td>{{ role.description }}</td>
        <td>{{ role.actif ? 'Oui' : 'Non' }}</td>
        <td>{{ getPermissionsList(role).join(', ') }}</td>
        <td>
          <button class="icon-button" (click)="toggleActif(role)">{{ role.actif ? 'Désactiver' : 'Activer' }}</button>
          <button class="icon-button" (click)="editRole(role)">Modifier</button>
          <button class="icon-button" (click)="deleteRole(role._id || '')">Supprimer</button>
          <button class="icon-button" (click)="viewRole(role._id || '')">Voir</button>
        </td>
      </tr>
    </tbody>
  </table>
  <div>
    <button class="action-button" (click)="loadRoleStats()">Afficher les Statistiques</button>
    <button class="action-button" (click)="exportToCSV()">Exporter en CSV</button>
  </div>
  <div *ngIf="statsVisible" class="mt-4" @fadeInOut>
    <h3>Statistiques des Rôles</h3>
    <table class="stats-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Nombre d'Utilisateurs</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let stat of roleStats">
          <td>{{ stat.nom }}</td>
          <td>{{ stat.totalUsers }}</td>
        </tr>
      </tbody>
    </table>
    <button class="action-button" (click)="hideStats()">Masquer</button>
  </div>
</div>