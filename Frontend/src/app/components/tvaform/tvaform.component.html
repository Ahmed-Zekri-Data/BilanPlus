<div *ngIf="isEditMode && !tva._id && isLoading ? loading : true">
  <h2>{{ isEditMode ? 'Modifier TVA' : 'Ajouter une nouvelle TVA' }}</h2>

  <form (ngSubmit)="saveTVA()">
    <div class="form-group">
      <label for="taux">Taux (%):</label>
      <input
        type="number"
        id="taux"
        name="taux"
        [(ngModel)]="tva.taux"
        required
        step="0.01"
        min="0"
      />
      <p *ngIf="fieldErrors.taux" class="error">{{ fieldErrors.taux }}</p>
    </div>

    <div class="form-group">
      <label for="montant">Montant (TND):</label>
      <input
        type="number"
        id="montant"
        name="montant"
        [(ngModel)]="tva.montant"
        required
        step="0.01"
        min="0"
      />
      <p *ngIf="fieldErrors.montant" class="error">{{ fieldErrors.montant }}</p>
    </div>

    <div class="form-group">
      <label for="declaration">Déclaration Fiscale:</label>
      <select
        id="declaration"
        name="declaration"
        [(ngModel)]="tva.declaration"
      >
        <option value="" disabled>Sélectionnez une déclaration</option>
        <option *ngFor="let decl of declarations" [value]="decl._id">
          {{ decl.periode }} (Montant: {{ decl.montantTotal | number:'1.2-2' }} TND)
        </option>
      </select>
      <p *ngIf="fieldErrors.declaration" class="error">{{ fieldErrors.declaration }}</p>
    </div>

    <div class="actions">
      <button mat-raised-button color="primary" type="submit">
        {{ isEditMode ? 'Mettre à jour TVA' : 'Ajouter TVA' }}
      </button>
      <button mat-raised-button (click)="goBack()">Annuler</button>
    </div>

    <div *ngIf="errors.length > 0 && !fieldErrors.taux && !fieldErrors.montant && !fieldErrors.declaration" class="error-container">
      <p class="error-title">Erreur(s) :</p>
      <ul>
        <li *ngFor="let error of errors" class="error">{{ error }}</li>
      </ul>
    </div>
  </form>
</div>

<ng-template #loading>
  <div *ngIf="errors.length > 0; else spinner" class="error-container">
    <p class="error-title">Erreur(s) :</p>
    <ul>
      <li *ngFor="let error of errors" class="error">{{ error }}</li>
    </ul>
  </div>
  <ng-template #spinner>
    <p>Chargement des détails de la TVA...</p>
  </ng-template>
</ng-template>